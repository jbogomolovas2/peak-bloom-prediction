"0","# Convert to data.table and compute 30-day rolling sums for each anomaly type"
"0","combined_anomalies <- as.data.table(combined_anomalies)"
"0","combined_anomalies[, temp_ave_pos_rollsum := frollsum(ifelse(T2M_anomaly > 0, T2M_anomaly, 0), n = 30, align = ""right""), by = location]"
"0","combined_anomalies[, temp_ave_neg_rollsum := frollsum(ifelse(T2M_anomaly < 0, T2M_anomaly, 0), n = 30, align = ""right""), by = location]"
"0","combined_anomalies[, temp_max_pos_rollsum := frollsum(ifelse(T2M_MAX_anomaly > 0, T2M_MAX_anomaly, 0), n = 30, align = ""right""), by = location]"
"0","combined_anomalies[, temp_max_neg_rollsum := frollsum(ifelse(T2M_MAX_anomaly < 0, T2M_MAX_anomaly, 0), n = 30, align = ""right""), by = location]"
"0","combined_anomalies[, temp_min_pos_rollsum := frollsum(ifelse(T2M_MIN_anomaly > 0, T2M_MIN_anomaly, 0), n = 30, align = ""right""), by = location]"
"0","combined_anomalies[, temp_min_neg_rollsum := frollsum(ifelse(T2M_MIN_anomaly < 0, T2M_MIN_anomaly, 0), n = 30, align = ""right""), by = location]"
"0","combined_anomalies[, prcp_pos_rollsum := frollsum(ifelse(PRECTOTCORR_anomaly > 0, PRECTOTCORR_anomaly, 0), n = 30, align = ""right""), by = location]"
"0","combined_anomalies[, prcp_neg_rollsum := frollsum(ifelse(PRECTOTCORR_anomaly < 0, PRECTOTCORR_anomaly, 0), n = 30, align = ""right""), by = location]"
"0",""
"0","# Create a numeric day-of-year and adjust to form a 'cherry_year'"
"0","combined_anomalies[, doy := as.numeric(format(YYYYMMDD, ""%j""))]"
"0","combined_anomalies[, cherry_year := ifelse(doy >= 100, year(YYYYMMDD) + 1, year(YYYYMMDD))]"
"0","combined_anomalies[, day_number := ifelse(doy >= 100, doy - 99, doy + (366 - 99))]"
"0",""
"0","small_anomaly_df <- combined_anomalies %>%"
"0","  select(-c(DOY, LON, LAT, YEAR, MM, DD, T2M, T2M_MAX, T2M_MIN, PRECTOTCORR,"
"0","            T2M_mean, T2M_MAX_mean, T2M_MIN_mean, PRECTOTCORR_mean,"
"0","            T2M_anomaly, T2M_MAX_anomaly, T2M_MIN_anomaly, PRECTOTCORR_anomaly))"
