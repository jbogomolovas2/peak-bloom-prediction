"0","# Function to calculate daily climate anomalies"
"0","calculate_climate_anomalies <- function(data, "
"0","                                        baseline_start = 1981, "
"0","                                        baseline_end = 2024, "
"0","                                        vars = c(""T2M"", ""T2M_MAX"", ""T2M_MIN"", ""PRECTOTCORR"")) {"
"0","  "
"0","  # Validate input variables"
"0","  if (!all(vars %in% names(data))) {"
"0","    stop(""Not all specified variables are present in the dataset."")"
"0","  }"
"0","  if (!all(c(""YEAR"", ""DOY"") %in% names(data))) {"
"0","    stop(""Dataset must include 'YEAR' and 'DOY' columns."")"
"0","  }"
"0","  "
"0","  # Create baseline subset"
"0","  baseline_data <- data[data$YEAR >= baseline_start & data$YEAR <= baseline_end, ]"
"0","  "
"0","  # Calculate daily climatology (mean for each day-of-year)"
"0","  climatology <- aggregate(baseline_data[vars], "
"0","                           by = list(DOY = baseline_data$DOY), "
"0","                           FUN = mean, "
"0","                           na.rm = TRUE)"
"0","  "
"0","  # Merge climatology with original data and compute anomalies"
"0","  result <- merge(data, climatology, by = ""DOY"", suffixes = c("""", ""_mean""))"
"0","  for (var in vars) {"
"0","    mean_col <- paste0(var, ""_mean"")"
"0","    anom_col <- paste0(var, ""_anomaly"")"
"0","    result[[anom_col]] <- result[[var]] - result[[mean_col]]"
"0","  }"
"0","  "
"0","  # Attach attributes and sort by date"
"0","  attr(result, ""baseline_period"") <- paste(baseline_start, ""-"", baseline_end)"
"0","  attr(result, ""variables"") <- vars"
"0","  result <- result[order(result$YYYYMMDD), ]"
"0","  "
"0","  return(result)"
"0","}"
"0",""
"0","# Calculate anomalies for each location"
"0","NY_temp_anomalies <- calculate_climate_anomalies(NY_temp)"
"0","Vancouver_temp_anomalies <- calculate_climate_anomalies(Vancouver_temp)"
"0","Swiss_temp_anomalies <- calculate_climate_anomalies(Swiss_temp)"
"0","Washington_temp_anomalies <- calculate_climate_anomalies(Washington_temp)"
"0","Kyoto_temp_anomalies <- calculate_climate_anomalies(Kyoto_temp)"
